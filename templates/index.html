<!doctype html>
<html>
  <head>
    <title>DMR Biclique Analysis</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      .biclique-card {
        margin-bottom: 1rem;
      }
      .component-section {
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">DMR Biclique Analysis</h1>

      {% if results.error %}
      <div class="alert alert-danger">Error: {{ results.error }}</div>
      {% else %}

      <!-- Summary Statistics -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">Summary Statistics</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  Total Components: {{ results.stats.total_components }}
                </li>
                <li class="list-group-item">
                  Components with Non-trivial Bicliques: {{
                  results.stats.components_with_bicliques }}
                </li>
                <li class="list-group-item">
                  Total Bicliques: {{ results.stats.total_bicliques }}
                </li>
                <li class="list-group-item">
                  Non-trivial Bicliques: {{ results.stats.non_trivial_bicliques
                  }}
                </li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6>Coverage Statistics</h6>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  DMRs: {{ results.coverage.dmrs.covered }}/{{
                  results.coverage.dmrs.total }} ({{
                  "%.1f"|format(results.coverage.dmrs.percentage * 100) }}%)
                </li>
                <li class="list-group-item">
                  Genes: {{ results.coverage.genes.covered }}/{{
                  results.coverage.genes.total }} ({{
                  "%.1f"|format(results.coverage.genes.percentage 100) }}%)
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Components with Bicliques -->
      <h2 class="mb-3">Components with Non-trivial Bicliques</h2>
      {% for component in results.components %}
      <div class="component-section">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              Component {{ component.id }} ({{ component.dmrs }} DMRs, {{
              component.genes }} genes)
            </h5>
          </div>
          <div class="card-body">
            <h6>Bicliques ({{ component.bicliques|length }}):</h6>
            <div class="row">
              {% for biclique in component.bicliques %}
              <div class="col-md-6">
                <div class="card biclique-card">
                  <div class="card-header">
                    Biclique Size: {{ biclique.size }}
                  </div>
                  <div class="card-body">
                    <p><strong>DMRs:</strong> {{ biclique.dmrs|join( ') }}</p>
                    <p>
                      <strong>Genes:</strong> {{ biclique.genes|join(', ') }}
                    </p>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            <div id="plotly-graph-{{ component.id }}" class="mt-4"></div>
            <script>
                                      var graph = {{ component.plotly_graph|safe }};
                                      Plotly.newPlot('plotly-graph-{{ component.id }}', graph.data
              graph.layout);
            </script>
          </div>
        </div>
      </div>
      {% endfor %} {% endif %}
    </div>
  </body>
</html>
