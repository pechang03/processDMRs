<html>
  <head>
    <title>DMR Analysis Statistics</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <div class="container-fluid mt-4">
      <!-- Navigation -->
      <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{{ url_for('index_route') }}">Home</a>
          </li>
          <li class="breadcrumb-item active">Statistics</li>
        </ol>
      </nav>

      <!-- Top Statistics Section -->
      <div class="card mb-4">
        <div class="card-header">
          <h3>Overall Statistics</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <!-- Coverage Statistics -->
            <div class="col-md-4">
              <h4>Coverage</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>DMR Coverage:</td>
                    <td>
                      {{ statistics.coverage.dmrs.covered }}/{{
                      statistics.coverage.dmrs.total }} ({{
                      "%.1f"|format(statistics.coverage.dmrs.percentage * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Gene Coverage:</td>
                    <td>
                      {{ statistics.coverage.genes.covered }}/{{
                      statistics.coverage.genes.total }} ({{
                      "%.1f"|format(statistics.coverage.genes.percentage * 100)
                      }}%)
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Edge Coverage -->
            <div class="col-md-4">
              <h4>Edge Coverage</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>Single Coverage:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('single', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('single_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Multiple Coverage:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('multiple', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('multiple_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Uncovered:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('uncovered', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('uncovered_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Dominating Set -->
            <div class="col-md-4">
              <h4>Dominating Set</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>Size:</td>
                    <td>{{ statistics.get('dominating_set', {}).get('size', 0) }}</td>
                  </tr>
                  <tr>
                    <td>Coverage:</td>
                    <td>
                      {{ "%.1f"|format(statistics.get('dominating_set', {}).get('percentage', 0) * 100) }}%
                    </td>
                  </tr>
                  <tr>
                    <td>Genes Dominated:</td>
                    <td>{{ statistics.get('dominating_set', {}).get('genes_dominated', 0) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content - Split View -->
      <div class="card mb-4">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="overall-tab" data-bs-toggle="tab" href="#overall" role="tab">
                Overall Statistics
              </a>
            </li>
            {% for timepoint in timepoint_info.keys() %}
            <li class="nav-item">
              <a class="nav-link" id="{{ timepoint }}-tab" data-bs-toggle="tab" href="#{{ timepoint }}" role="tab">
                {{ timepoint }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content">
            <!-- Overall Statistics Tab -->
            <div class="tab-pane fade show active" id="overall" role="tabpanel">
              <div class="row">
                <!-- Original Graph Statistics -->
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3>Original Graph Components</h3>
                    </div>
                    <div class="card-body">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Type</th>
                            <th>Total</th>
                            <th>Single Node</th>
                            <th>Small</th>
                            <th>Interesting</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>Connected</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('connected', {}).get('total', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('connected', {}).get('single_node', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('connected', {}).get('small', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('connected', {}).get('interesting', 0) }}</td>
                          </tr>
                          <tr>
                            <td>Biconnected</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('biconnected', {}).get('total', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('biconnected', {}).get('single_node', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('biconnected', {}).get('small', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('biconnected', {}).get('interesting', 0) }}</td>
                          </tr>
                          <tr>
                            <td>Triconnected</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('triconnected', {}).get('total', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('triconnected', {}).get('single_node', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('triconnected', {}).get('small', 0) }}</td>
                            <td>{{ statistics.get('components', {}).get('original', {}).get('triconnected', {}).get('interesting', 0) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Biclique Graph Components -->
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3>Biclique Graph Components</h3>
                    </div>
                    <div class="card-body">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Category</th>
                            <th>Count</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>Empty Components</td>
                            <td>{{ statistics.get('biclique_types', {}).get('empty', 0) }}</td>
                          </tr>
                          <tr>
                            <td>Simple Components</td>
                            <td>{{ statistics.get('biclique_types', {}).get('simple', 0) }}</td>
                          </tr>
                          <tr>
                            <td>Interesting Components</td>
                            <td>{{ statistics.get('biclique_types', {}).get('interesting', 0) }}</td>
                          </tr>
                          <tr>
                            <td>Complex Components</td>
                            <td>{{ statistics.get('biclique_types', {}).get('complex', 0) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Timepoint-specific tabs -->
            {% for timepoint, data in timepoint_info.items() %}
            <div class="tab-pane fade" id="{{ timepoint }}" role="tabpanel">
              {% if data.status == "error" %}
                <div class="alert alert-danger">
                  Error processing timepoint: {{ data.message }}
                </div>
              {% else %}
                <div class="row">
                  <!-- Timepoint Original Graph Stats -->
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <h3>{{ timepoint }} Components</h3>
                      </div>
                      <div class="card-body">
                        <table class="table">
                          <thead>
                            <tr>
                              <th>Type</th>
                              <th>Total</th>
                              <th>Single Node</th>
                              <th>Small</th>
                              <th>Interesting</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Connected</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('connected', {}).get('total', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('connected', {}).get('single_node', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('connected', {}).get('small', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('connected', {}).get('interesting', 0) }}</td>
                            </tr>
                            <tr>
                              <td>Biconnected</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('biconnected', {}).get('total', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('biconnected', {}).get('single_node', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('biconnected', {}).get('small', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('biconnected', {}).get('interesting', 0) }}</td>
                            </tr>
                            <tr>
                              <td>Triconnected</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('triconnected', {}).get('total', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('triconnected', {}).get('single_node', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('triconnected', {}).get('small', 0) }}</td>
                              <td>{{ data.get('stats', {}).get('components', {}).get('original', {}).get('triconnected', {}).get('interesting', 0) }}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>

                  <!-- Timepoint Coverage Stats -->
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <h3>{{ timepoint }} Coverage</h3>
                      </div>
                      <div class="card-body">
                        <table class="table">
                          <tbody>
                            <tr>
                              <td>DMR Coverage:</td>
                              <td>
                                {{ data.get('coverage', {}).get('dmrs', {}).get('covered', 0) }}/{{ data.get('coverage', {}).get('dmrs', {}).get('total', 0) }}
                                ({{ "%.1f"|format(data.get('coverage', {}).get('dmrs', {}).get('percentage', 0) * 100) }}%)
                              </td>
                            </tr>
                            <tr>
                              <td>Gene Coverage:</td>
                              <td>
                                {{ data.get('coverage', {}).get('genes', {}).get('covered', 0) }}/{{ data.get('coverage', {}).get('genes', {}).get('total', 0) }}
                                ({{ "%.1f"|format(data.get('coverage', {}).get('genes', {}).get('percentage', 0) * 100) }}%)
                              </td>
                            </tr>
                            <tr>
                              <td>Edge Coverage:</td>
                              <td>
                                Single: {{ data.get('coverage', {}).get('edges', {}).get('single_coverage', 0) }}
                                ({{ "%.1f"|format(data.get('coverage', {}).get('edges', {}).get('single_percentage', 0) * 100) }}%)<br>
                                Multiple: {{ data.get('coverage', {}).get('edges', {}).get('multiple_coverage', 0) }}
                                ({{ "%.1f"|format(data.get('coverage', {}).get('edges', {}).get('multiple_percentage', 0) * 100) }}%)<br>
                                Uncovered: {{ data.get('coverage', {}).get('edges', {}).get('uncovered', 0) }}
                                ({{ "%.1f"|format(data.get('coverage', {}).get('edges', {}).get('uncovered_percentage', 0) * 100) }}%)
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
