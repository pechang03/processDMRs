<html>
  <head>
    <title>DMR Analysis Statistics</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <div class="container-fluid mt-4">
      <!-- Navigation -->
      <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{{ url_for('index_route') }}">Home</a>
          </li>
          <li class="breadcrumb-item active">Statistics</li>
        </ol>
      </nav>

      <!-- Top Statistics Section -->
      <div class="card mb-4">
        <div class="card-header">
          <h3>Overall Statistics</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <!-- Coverage Statistics -->
            <div class="col-md-4">
              <h4>Coverage</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>DMR Coverage:</td>
                    <td>
                      {{ statistics.coverage.dmrs.covered }}/{{
                      statistics.coverage.dmrs.total }} ({{
                      "%.1f"|format(statistics.coverage.dmrs.percentage * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Gene Coverage:</td>
                    <td>
                      {{ statistics.coverage.genes.covered }}/{{
                      statistics.coverage.genes.total }} ({{
                      "%.1f"|format(statistics.coverage.genes.percentage * 100)
                      }}%)
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Edge Coverage -->
            <div class="col-md-4">
              <h4>Edge Coverage</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>Single Coverage:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('single', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('single_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Multiple Coverage:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('multiple', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('multiple_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                  <tr>
                    <td>Uncovered:</td>
                    <td>
                      {{ statistics.get('edge_coverage', {}).get('uncovered', 0) }} ({{
                      "%.1f"|format(statistics.get('edge_coverage', {}).get('uncovered_percentage', 0) * 100)
                      }}%)
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Dominating Set -->
            <div class="col-md-4">
              <h4>Dominating Set</h4>
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td>Size:</td>
                    <td>{{ statistics.dominating_set.size }}</td>
                  </tr>
                  <tr>
                    <td>Coverage:</td>
                    <td>
                      {{ "%.1f"|format(statistics.dominating_set.percentage *
                      100) }}%
                    </td>
                  </tr>
                  <tr>
                    <td>Genes Dominated:</td>
                    <td>{{ statistics.dominating_set.genes_dominated }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content - Split View -->
      <div class="row">
        <!-- Original Graph Statistics -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3>Original Graph Components</h3>
            </div>
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Total</th>
                    <th>Single Node</th>
                    <th>Small</th>
                    <th>Interesting</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Connected</td>
                    <td>
                      {{ statistics.components.original.connected.total }}
                    </td>
                    <td>
                      {{ statistics.components.original.connected.single_node }}
                    </td>
                    <td>
                      {{ statistics.components.original.connected.small }}
                    </td>
                    <td>
                      {{ statistics.components.original.connected.interesting }}
                    </td>
                  </tr>
                  <tr>
                    <td>Biconnected</td>
                    <td>
                      {{ statistics.components.original.biconnected.total }}
                    </td>
                    <td>
                      {{ statistics.components.original.biconnected.single_node
                      }}
                    </td>
                    <td>
                      {{ statistics.components.original.biconnected.small }}
                    </td>
                    <td>
                      {{ statistics.components.original.biconnected.interesting
                      }}
                    </td>
                  </tr>
                  <tr>
                    <td>Triconnected</td>
                    <td>
                      {{ statistics.components.original.triconnected.total }}
                    </td>
                    <td>
                      {{ statistics.components.original.triconnected.single_node }}
                    </td>
                    <td>
                      {{ statistics.components.original.triconnected.small }}
                    </td>
                    <td>
                      {{ statistics.components.original.triconnected.interesting }}
                    </td>
                  </tr>
                  <tr class="text-muted">
                    <td colspan="5" class="small">
                      <em>Note: {{ statistics.components.original.triconnected.skipped_simple }} simple components skipped for triconnected analysis</em>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Replace the existing Biclique Graph Components card with this -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3>Biclique Graph Components</h3>
            </div>
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Category</th>
                    <th>Count</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Empty Components</td>
                    <td>{{ statistics.get('biclique_types', {}).get('empty', 0) }}</td>
                  </tr>
                  <tr>
                    <td>Simple Components</td>
                    <td>{{ statistics.get('biclique_types', {}).get('simple', 0) }}</td>
                  </tr>
                  <tr>
                    <td>Interesting Components</td>
                    <td>{{ statistics.get('biclique_types', {}).get('interesting', 0) }}</td>
                  </tr>
                  <tr>
                    <td>Complex Components</td>
                    <td>{{ statistics.get('biclique_types', {}).get('complex', 0) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Components Tables -->
      <div class="row mt-4">
        <!-- Triconnected Components -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3>Triconnected Components</h3>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Component ID</th>
                      <th>DMRs</th>
                      <th>Genes</th>
                      <th>Total Edges</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for component in statistics.components.original.triconnected.components %}
                    <tr>
                      <td>{{ component.id }}</td>
                      <td>{{ component.dmrs|length }}</td>
                      <td>{{ component.genes|length }}</td>
                      <td>{{ component.edges|length }}</td>
                      <td>
                        <a
                          href="{{ url_for('component_detail', component_id=component.id, type='triconnected') }}"
                          class="btn btn-primary btn-sm"
                        >
                          View Graph
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Biclique Components -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3>Interesting Components</h3>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Component ID</th>
                      <th>DMRs</th>
                      <th>Genes</th>
                      <th>Split Genes</th>
                      <th>Total Bicliques</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for component in bicliques_result.interesting_components %}
                    <tr>
                      <td>{{ component.id }}</td>
                      <td>{{ component.dmrs }}</td>
                      <td>{{ component.total_genes }}</td>
                      <td>{{ component.split_genes|length }}</td>
                      <td>{{ component.raw_bicliques|length }}</td>
                      <td>
                        <a
                          href="{{ url_for('component_detail', component_id=component.id, type='biclique') }}"
                          class="btn btn-primary btn-sm"
                        >
                          View Graph
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
